<link rel="import" href="/lib/paper-tabs-master/paper-tab.html" />
<link rel="import" href="/lib/paper-tabs-master/paper-tabs.html" />
<link rel="import" href="/lib/iron-pages-master/iron-pages.html" />
<link rel="import" href="/lib/iron-menu-behavior/iron-menubar-behavior.html" />
<link rel="import" href="/lib/iron-form/iron-form.html" />
<link rel="import" href="/lib/paper-input/paper-input.html" />
<link rel="import" href="/lib/paper-checkbox-master/paper-checkbox.html" />
<link rel="import" href="/lib/paper-button/paper-button.html" />
<link rel="import" href="/lib/vaadin-combo-box/vaadin-combo-box.html" />
<link rel="import" href="/lib/paper-input/paper-input.html" />
<link rel="import" href="/lib/paper-button/paper-button.html" />
<link rel="import" href="/lib/paper-toast-master/paper-toast.html" />
<link rel="import" href="/lib/vaadin-date-picker/vaadin-date-picker.html">
<link rel="import" href="/lib/vaadin-material-theme/vaadin-date-picker.html">

<dom-module id="x-procedimentodetails">
    <template>
        <!-- STYLES -->
        <link rel="stylesheet" href="/lib/bootstrap/dist/css/bootstrap.css" />
        <link rel="stylesheet" href="/lib/font-awesome-4.7.0/css/font-awesome.min.css" />
        <link rel="stylesheet" href="/css/main.css" />
        <style>
            vaadin-combo-box {
                padding: 1px 0 !important;
            }

            vaadin-date-picker {
                margin-top: -14px;
                width: 100%;
                padding-top: 0px;
            }

            .break_clear {
                margin-top: 15px;
            }
        </style>

        <!-- -->
        <iron-ajax url="/ProcedimentosCcps/GetProcedimentoDetails"
                   last-response="{{data}}"
                   method="post"
                   handle-as="json"
                   id="grid_databound_ajax"
                   content-type="application/json">
        </iron-ajax>
        <template is="dom-if" if="{{ !_isCreate }}">
            <div class="row">
                <div class="col-lg-12">
                    <paper-button raised id="btnActas" class=""><i class="fa fa-eye" aria-hidden="true"></i>&nbsp;Registo de Actas</paper-button>
                    <paper-button raised id="btnTempos" class=""><i class="fa fa-eye" aria-hidden="true"></i>&nbsp;Tempos</paper-button>
                </div>
            </div>
        </template>
        <paper-tabs fit-container no-slide autoselect autoselect-delay="0" selected="{{selected}}">
            <paper-tab>Geral xxx</paper-tab>
            <paper-tab>Registo xxx</paper-tab>
            <paper-tab>Faturação xxx</paper-tab>
            <paper-tab>Envio xxx</paper-tab>
            <paper-tab>Detalhe xxx</paper-tab>
            <paper-tab>AEC xxx</paper-tab>
        </paper-tabs>
        <!--Geral-->
        <div>
            <div class="row">
                <div class="col-lg-3">
                    <paper-input type="text" value="{{data.no}}" disabled="{{ !_isCreate }}" id="No" name="No" ed required label="Nº Procedimento"> </paper-input>
                </div>              
            </div>
        </div>
        <script>
            document.addEventListener('WebComponentsReady', function () {
                debugger;
                Polymer({
                    is: 'x-procedimentodetails',
                    properties: {
                        _areaid: {
                            type: Number,
                            notify: true,
                            value: 0
                        },
                        _procedimentoid: {
                            type: String,
                            notify: true,
                            value: ""
                        },
                        selected: {
                            type: Number,
                            value: 0
                        },
                        _isCreate: {
                            type: Boolean,
                            value: false
                        }
                    },

                    ready: function () {
                        //GET PROJECT DATA
                        this.$.page_databound_ajax.body = JSON.stringify({ "No": this._procedimentoid });
                        this.$.page_databound_ajax.generateRequest();


                        //this.$.contracts_ajax.body = JSON.stringify({ "areaId": this._areaid });
                        //this.$.contracts_ajax.generateRequest();

                        if (this._procedimentoid == "") {
                            this._isCreate = true;
                            //this.data.area = this._areaid;
                        }
                    },
                    _openToast: function (message) {
                        this.$.ToastMessage.text = message;
                        this.$.ToastMessage.open();
                    },
                    _validateData: function () {
                        if (false) {
                            this._openToast(validate);
                            return false;
                        }
                        return true;
                    },

                    //CRUDS
                    _create: function () {
                        if (this._validateData()) {
                            this.$.page_validator_ajax.body = JSON.stringify(this.data);
                            this.$.page_validator_ajax.generateRequest();
                        }
                    },
                    _update: function () {
                        if (this._validateData()) {
                            this._executeRequest("/Projetos/UpdateProject", this.data)
                        }
                    },

                    //Responses Processors
                    _responseProcessor: function (data) {
                        //var self = this;

                        ////Set AreaId
                        //if (this.data.projectNo == "") {
                        //    this.data.area = this._areaid;
                        //}

                        //if (data.detail.status === 200) {
                        //    if (data.detail.url.indexOf("GetProject") !== -1) {
                        //        if (this.data.ProjectNo == "") {
                        //            this._isCreate = true;
                        //        }
                        //    } else if (data.detail.url.indexOf("Create") !== -1) {
                        //        this._createResponseProcessor();
                        //    }
                        //} else {
                        //    this._openToast("Ocorreu um erro ao criar o projeto.")
                        //}
                    },
                    _createResponseProcessor: function () {
                        //if (this.data.eReasonCode == 1) {
                        //    this._isCreate = false;
                        //    this._openToast("Projeto criado com sucesso.");
                        //} else {
                        //    this._openToast(this.data.eMessage);
                        //}
                    },

                    _responseValidatorProcessor: function (data) {
                        //var self = this;
                        //if (data.detail.status === 200) {
                        //    debugger;;
                        //    if (this.validateResponse == "") {
                        //        this._executeRequest("/Projetos/CreateProject", this.data)
                        //    } else {
                        //        this._openToast(data);
                        //    }
                        //}
                    },

                    //Helpers
                    _executeRequest: function (url, data) {
                        this.$.page_databound_ajax.url = url;
                        this.$.page_databound_ajax.body = JSON.stringify(data);
                        this.$.page_databound_ajax.generateRequest();
                    }

                });
            });
        </script>
    </template>
</dom-module>