
@{
    ViewData["Title"] = "TiposGrupoContabOMProjeto";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@*grid*@
<link rel="import" href="~/lib/vaadin-grid/vaadin-grid.html" />
<link rel="import" href="~/lib/vaadin-grid/vaadin-grid-sorter.html" />
<link rel="import" href="~/lib/vaadin-grid/vaadin-grid-sort-behavior.html" />
<link rel="import" href="~/lib/vaadin-grid/vaadin-grid-filter.html" />
<link rel="import" href="~/lib/vaadin-grid/vaadin-grid-filter-behavior.html" />
<link rel="import" href="~/lib/vaadin-valo-theme/vaadin-grid.html">
@*checkbox*@
<link rel="import" href="~/lib/vaadin-valo-theme/vaadin-checkbox.html">
<link rel="import" href="~/lib/vaadin-checkbox/vaadin-checkbox.html">
@*textfield*@
<link rel="import" href="~/lib/vaadin-valo-theme/vaadin-text-field.html">
<link rel="import" href="~/lib/vaadin-text-field/vaadin-text-field.html">
@*combobox*@
<link rel="import" href="~/lib/vaadin-valo-theme/vaadin-combo-box.html" />
<link rel="import" href="~/lib/vaadin-combo-box/vaadin-combo-box.html" />
@*toast*@
<link rel="import" href="~/lib/paper-toast-master/paper-toast.html" />
@*layout*@
<link rel="import" href="~/lib/iron-flex-layout/iron-flex-layout.html" />
<link rel="import" href="~/lib/iron-flex-layout/iron-flex-layout-classes.html" />
@*mixin*@
<link rel="import" href="~/lib/vaadin-themable-mixin/vaadin-themable-mixin.html" />
@*button*@
<link rel="import" href="~/lib/paper-button/paper-button.html" />
@*ironform*@
<link rel="import" href="~/lib/iron-form/iron-form.html" />
@*paperinput*@
<link rel="import" href="~/lib/paper-input/paper-input.html" />

<h1 class="title">Tipos Grupos Contabilísticos OM</h1>

<x-contab-group-types-om></x-contab-group-types-om>

<dom-module id="x-contab-group-types-om">
<template>
<link rel="stylesheet" href="/lib/bootstrap/dist/css/bootstrap.css" />
<link rel="stylesheet" href="~/lib/font-awesome-4.7.0/css/font-awesome.min.css" />
<link rel="stylesheet" href="/css/main.css" />


<custom-style>
    <style is="custom-style">
        input[readonly] {
            border: 2px solid transparent;
        }

        input {
            font: inherit;
        }

        paper-input {
            max-width: 450px !important;
        }
    </style>
</custom-style>

@*POPULATE GRID*@
<iron-ajax url="/Administracao/GetTiposGrupoContabOMProjeto"
           last-response="{{result}}"
           method="post"
           auto
           handle-as="json"
           id="page_databound_ajax"
           content-type="application/json">
</iron-ajax>
@*POPULATE Update*@
<iron-ajax url="/Administracao/UpdateTiposGrupoContabProjetoOM"
           last-response="{{result}}"
           method="post"
           handle-as="json"
           id="update_ajax"
           on-response="_updateResponse"
           content-type="application/json">
</iron-ajax>

@*CRUD - Populate Combos*@
<iron-ajax url="/PopulateDropdowns/GetContabGroupTypesOM_Type"
           last-response="{{CGTOM_Type}}"
           auto
           method="post"
           handle-as="json"
           content-type="application/json">
</iron-ajax>
<iron-ajax url="/PopulateDropdowns/GetContabGroupTypesOM_FailType"
           last-response="{{CGTOM_FailType}}"
           auto
           method="post"
           handle-as="json"
           content-type="application/json">
</iron-ajax>

<iron-form id="formGeral">
    <form>
        <h2 class="separator">Novo Registo</h2>
        <table class="table inlineForm">
            <tr>
                <td width="15%"><vaadin-text-field id="ddDescription" label="Descrição"></vaadin-text-field></td>
                <td width="15%"> <vaadin-combo-box items="[[CGTOM_Type]]" item-value-path="id" item-label-path="value" value="{{ddCGTOM_Type}}" label="Tipo">
                    <template>
                        <table width="200px">
                            <tr>
                                <td width="20%" text-align="left">[[item.id]]</td>
                                <td width="80%" text-align="left"> <b>[[item.value]]</b></td>
                            </tr>
                        </table>
                    </template>
                </vaadin-combo-box></td>
                <td width="15%"><vaadin-checkbox id="chkCorrectiveMaintenance"> Manut. Correctiva </vaadin-checkbox></td>
                <td width="15%"><vaadin-checkbox id="chkPreventiveMaintenance"> Manut. Preventiva </vaadin-checkbox></td>
                <td width="15%">
                    <vaadin-combo-box items="[[CGTOM_FailType]]" item-value-path="id" item-label-path="value" value="{{ddCGTOM_FailType}}" label="Tipo Razão Falha">
                        <template>
                            <table width="160px">
                                <tr>
                                    <td width="30%" text-align="left">[[item.id]]</td>
                                    <td width="70%" text-align="left"> <b>[[item.value]]</b></td>
                                </tr>
                            </table>
                        </template>
                    </vaadin-combo-box>
                </td>
                <td width="15%"><vaadin-checkbox id="chkResponseTimeIndicator">Ind. Tempo Resposta</vaadin-checkbox></td>
            </tr>
            <tr>
                <td width="15%"><vaadin-checkbox id="chkStopTimeIndicator"> Ind. Tempo Imobilização </vaadin-checkbox> </td>
                <td width="15%"><vaadin-checkbox id="chkRepairEffectiveTimeIndicator"> Ind. Tempo Efetivo Reparação </vaadin-checkbox> </td>
                <td width="15%"><vaadin-checkbox id="chkClosingWorksTimeIndicator"> Ind. Tempo Fecho Obras </vaadin-checkbox> </td>
                <td width="15%"><vaadin-checkbox id="chkBillingTimeIndicator"> Ind. Tempo Faturação </vaadin-checkbox> </td>
                <td width="15%"><vaadin-checkbox id="chkEmployeesOccupationTimeIndicator">Ind. Tempo Ocup. Colaboradores</vaadin-checkbox> </td>
                <td width="15%"><vaadin-checkbox id="chkCostSaleValueIndicator">Ind. Valor Custo/Venda</vaadin-checkbox> </td>
            </tr>
            <tr>
                <td width="15%"><vaadin-checkbox id="chkCATCoverageRateIndicator">Ind. Taxa Cobertura CAT</vaadin-checkbox></td>
                <td width="15%"> <vaadin-checkbox id="chkCATComplianceRateIndicator">Ind. Taxa Cumprimento CAT</vaadin-checkbox></td>
                <td width="15%"><vaadin-checkbox id="chkMPRoutineFulfillmentRateIndicator">Ind. Taxa Cumpr. Rotinas MP</vaadin-checkbox> </td>
                <td width="15%"><vaadin-checkbox id="chkBreakoutIncidentsIndicator">Ind. Incidências Avarias</vaadin-checkbox></td>
                <td width="15%"><vaadin-checkbox id="chkOrdernInProgressIndicator">Ind. Ordens em Curso</vaadin-checkbox></td>
                <td width="15%"><paper-button class="btnSave" on-tap="_createContabGroupTypeOM">Criar</paper-button></td>
            </tr>

        </table>
    </form>
</iron-form>

<vaadin-grid id="gridContabGroupTypesOM" aria-label="gridContabGroupTypesTableOM" items="[[result]]" class="grid" multi-sort="true">
    <vaadin-grid-column  width="200px" resizable>
        <template class="header">
            <vaadin-grid-sorter path="code">Código</vaadin-grid-sorter>
            <vaadin-grid-filter path="code" />
        </template>
        <template>
            <vaadin-text-field value="{{item.code}}" disabled></vaadin-text-field>
        </template>
    </vaadin-grid-column>
    <vaadin-grid-column width="200px" resizable>
        <template class="header">
            <vaadin-grid-sorter path="type">Tipo</vaadin-grid-sorter>
            <vaadin-grid-filter path="type" />
        </template>
        <template>
            <vaadin-combo-box items="[[CGTOM_Type]]" item-value-path="id" item-label-path="value" value="{{item.type}}">
                <template>
                    <table width="200px">
                        <tr>
                            <td width="20%" text-align="left">[[item.id]]</td>
                            <td width="80%" text-align="left"> <b>[[item.value]]</b></td>
                        </tr>
                    </table>
                </template>
            </vaadin-combo-box>
        </template>
    </vaadin-grid-column>
    <vaadin-grid-column  width="200px" resizable>
        <template class="header">
            <vaadin-grid-sorter path="description">Descrição</vaadin-grid-sorter>
            <vaadin-grid-filter path="description" />
        </template>
        <template>
            <vaadin-text-field value="{{item.description}}"></vaadin-text-field>
        </template>
    </vaadin-grid-column>
    <vaadin-grid-column  width="200px" resizable>
        <template class="header">
            <vaadin-grid-sorter path="correctiveMaintenance">Manut. Corretiva</vaadin-grid-sorter>
        </template>
        <template>
            <vaadin-checkbox checked="{{item.correctiveMaintenance}}"></vaadin-checkbox>
        </template>
    </vaadin-grid-column>
    <vaadin-grid-column width="200px" resizable>
        <template class="header">
            <vaadin-grid-sorter path="preventiveMaintenance">Manut. Preventiva</vaadin-grid-sorter>
        </template>
        <template>
            <vaadin-checkbox checked="{{item.preventiveMaintenance}}"></vaadin-checkbox>
        </template>
    </vaadin-grid-column>
    <vaadin-grid-column width="200px" resizable>
        <template class="header">
            <vaadin-grid-sorter path="failType">Tipo Razão Falha</vaadin-grid-sorter>
            <vaadin-grid-filter path="failType" />
        </template>
        <template>
            <vaadin-combo-box items="[[CGTOM_FailType]]" item-value-path="id" item-label-path="value" value="{{item.failType}}">
                <template>
                    <table width="160px">
                        <tr>
                            <td width="30%" text-align="left">[[item.id]]</td>
                            <td width="70%" text-align="left"> <b>[[item.value]]</b></td>
                        </tr>
                    </table>
                </template>
            </vaadin-combo-box>
        </template>
    </vaadin-grid-column>
    <vaadin-grid-column width="200px" resizable>
        <template class="header">
            <vaadin-grid-sorter path="responseTimeIndicator">Ind. Tempo Resposta</vaadin-grid-sorter>
        </template>
        <template>
            <vaadin-checkbox checked="{{item.responseTimeIndicator}}"></vaadin-checkbox>
        </template>
    </vaadin-grid-column>
    <vaadin-grid-column width="200px" resizable>
        <template class="header">
            <vaadin-grid-sorter path="stopTimeIndicator">Ind. Tempo Imobilização</vaadin-grid-sorter>
        </template>
        <template>
            <vaadin-checkbox checked="{{item.stopTimeIndicator}}"></vaadin-checkbox>
        </template>
    </vaadin-grid-column>
    <vaadin-grid-column width="200px" resizable>
        <template class="header">
            <vaadin-grid-sorter path="repairEffectiveTimeIndicator">Ind. Tempo Efetivo Reparação</vaadin-grid-sorter>
        </template>
        <template>
            <vaadin-checkbox checked="{{item.repairEffectiveTimeIndicator}}"></vaadin-checkbox>
        </template>
    </vaadin-grid-column>
    <vaadin-grid-column width="200px" resizable>
        <template class="header">
            <vaadin-grid-sorter path="closingWorksTimeIndicator">Ind. Tempo Fecho Obras</vaadin-grid-sorter>
        </template>
        <template>
            <vaadin-checkbox checked="{{item.closingWorksTimeIndicator}}"></vaadin-checkbox>
        </template>
    </vaadin-grid-column>
    <vaadin-grid-column width="200px" resizable>
        <template class="header">
            <vaadin-grid-sorter path="billingTimeIndicator">Ind. Tempo Faturação</vaadin-grid-sorter>
        </template>
        <template>
            <vaadin-checkbox checked="{{item.billingTimeIndicator}}"></vaadin-checkbox>
        </template>
    </vaadin-grid-column>
    <vaadin-grid-column width="200px" resizable>
        <template class="header">
            <vaadin-grid-sorter path="employeesOccupationTimeIndicator">Ind. Tempo Ocup. Colaboradores</vaadin-grid-sorter>
        </template>
        <template>
            <vaadin-checkbox checked="{{item.employeesOccupationTimeIndicator}}"></vaadin-checkbox>
        </template>
    </vaadin-grid-column>
    <vaadin-grid-column width="200px" resizable>
        <template class="header">
            <vaadin-grid-sorter path="costSaleValueIndicator">Ind. Valor Custo/Venda</vaadin-grid-sorter>
        </template>
        <template>
            <vaadin-checkbox checked="{{item.costSaleValueIndicator}}"></vaadin-checkbox>
        </template>
    </vaadin-grid-column>
    <vaadin-grid-column width="200px" resizable>
        <template class="header">
            <vaadin-grid-sorter path="catComplianceRateIndicator">Ind. Taxa Cumprimento CAT</vaadin-grid-sorter>
        </template>
        <template>
            <vaadin-checkbox checked="{{item.catComplianceRateIndicator}}"></vaadin-checkbox>
        </template>
    </vaadin-grid-column>
    <vaadin-grid-column width="200px" resizable>
        <template class="header">
            <vaadin-grid-sorter path="catCoverageRateIndicator">Ind. Taxa Cobertura CAT</vaadin-grid-sorter>
        </template>
        <template>
            <vaadin-checkbox checked="{{item.catCoverageRateIndicator}}"></vaadin-checkbox>
        </template>
    </vaadin-grid-column>
    <vaadin-grid-column width="200px" resizable>
        <template class="header">
            <vaadin-grid-sorter path="mpRoutineFulfillmentRateIndicator">Ind. Taxa Cumpr. Rotinas</vaadin-grid-sorter>
        </template>
        <template>
            <vaadin-checkbox checked="{{item.mpRoutineFulfillmentRateIndicator}}"></vaadin-checkbox>
        </template>
    </vaadin-grid-column>
    <vaadin-grid-column width="200px" resizable>
        <template class="header">
            <vaadin-grid-sorter path="breakoutIncidentsIndicator">Ind. Incidencias Avarias</vaadin-grid-sorter>
        </template>
        <template>
            <vaadin-checkbox checked="{{item.breakoutIncidentsIndicator}}"></vaadin-checkbox>
        </template>
    </vaadin-grid-column>
    <vaadin-grid-column width="200px" resizable>
        <template class="header">
            <vaadin-grid-sorter path="ordernInProgressIndicator">Ind. Ordens em Curso</vaadin-grid-sorter>
        </template>
        <template>
            <vaadin-checkbox checked="{{item.ordernInProgressIndicator}}"></vaadin-checkbox>
        </template>
    </vaadin-grid-column>
    <vaadin-grid-column width="200px" resizable>
        <template class="header">
        </template>
        <template>
            <center>
                <paper-button class="btnRemove" raised on-tap="_deleteAccessProfile">Eliminar</paper-button>
            </center>
        </template>
    </vaadin-grid-column>
</vaadin-grid>

<div class="marginSpace">
    <paper-button raised id="btnAddNew" class="btnEdit" on-tap="_update"><i class="fa fa-floppy-o" aria-hidden="true"></i>&nbsp; Guardar</paper-button>
    <paper-button raised id="btnCancel" class="btnRemove" on-tap="_cancel"><i class="fa fa-undo" aria-hidden="true"></i>&nbsp; Cancelar</paper-button>
</div>
<paper-toast id="ToastMessage" duration="4000" horizontalAlign="right"></paper-toast>
</template>

<script>
    document.addEventListener('WebComponentsReady', function () {
        Polymer({
            is: 'x-contab-group-types-om',
            properties: {
                ddCGTOM_Type: {
                    type: Number,
                    notify: true,
                    value: ""
                },

                ddCGTOM_FailType: {
                    type: Number,
                    notify: true,
                    value: ""
                },
            },
            ready: function () {
                this.$.page_databound_ajax.generateRequest();
            },
            openToast: function (message) {
                this.$.ToastMessage.text = message;
                this.$.ToastMessage.open();
            },

            _update: function () {
                this.$.update_ajax.body = JSON.stringify(this.result);
                this.$.update_ajax.generateRequest();
                this.$.gridContabGroupTypesOM.clearCache();
            },

            _updateResponse: function (e) {
                var self = this;
                if (e.detail.status === 200) {

                    this.openToast('Atualizado com sucesso!');
                    this.$.page_databound_ajax.generateRequest();
                    this.$.gridContabGroupTypesOM.clearCache();
                }
                else {
                    this.openToast('Ocorreu um erro ao atualizar o perfil modelo.');
                }
            },
            _cancel: function () {
                this.$.page_databound_ajax.generateRequest();
                this.$.gridContabGroupTypesOM.clearCache();
            },

            _createContabGroupTypeOM: function () {
                this.result.unshift({
                    description: this.$.ddDescription.value,
                    type: this.ddCGTOM_Type,
                    CorrectiveMaintenance: this.chkCorrectiveMaintenance,
                    PreventiveMaintenance: this.chkPreventiveMaintenance,
                    FailType: this.ddCGTOM_FailType,
                    ResponseTimeIndicator: this.chkResponseTimeIndicator,
                    StopTimeIndicator: this.chkStopTimeIndicator,
                    RepairEffectiveTimeIndicator: this.chkRepairEffectiveTimeIndicator,
                    ClosingWorksTimeIndicator: this.chkClosingWorksTimeIndicator,
                    BillingTimeIndicator: this.chkBillingTimeIndicator,
                    EmployeesOccupationTimeIndicator: this.chkEmployeesOccupationTimeIndicator,
                    CostSaleValueIndicator: this.chkCostSaleValueIndicator,
                    catComplianceRateIndicator: this.chkCATComplianceRateIndicator,
                    catCoverageRateIndicator: this.chkCATCoverageRateIndicator,
                    mpRoutineFulfillmentRateIndicator: this.chkMPRoutineFulfillmentRateIndicator,
                    BreakoutIncidentsIndicator: this.chkBreakoutIncidentsIndicator,
                    OrdernInProgressIndicator: this.chkOrdernInProgressIndicator
                });
                this.$.update_ajax.body = JSON.stringify(this.result);
                this.$.update_ajax.generateRequest();
                this.$.gridContabGroupTypesOM.clearCache();
            },

            _deleteAccessProfile: function (data) {
                var index = this.result.indexOf(data.model.item);
                this.result.splice(index, 1);
                this.$.update_ajax.body = JSON.stringify(this.result);
                this.$.update_ajax.generateRequest();
                this.$.gridContabGroupTypesOM.clearCache();
            }

        });
    });
</script>
</dom-module>
