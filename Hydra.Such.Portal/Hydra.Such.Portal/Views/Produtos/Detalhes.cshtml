
@{
    ViewData["Title"] = "Detalhe de Produto";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="import" href="/lib/paper-tabs-master/paper-tab.html" />
<link rel="import" href="/lib/paper-tabs-master/paper-tabs.html" />
<link rel="import" href="/lib/iron-pages-master/iron-pages.html" />
<link rel="import" href="/lib/iron-menu-behavior/iron-menubar-behavior.html" />
<link rel="import" href="/lib/iron-form/iron-form.html" />
<link rel="import" href="/lib/paper-button/paper-button.html" />
<link rel="import" href="/lib/paper-button/paper-button.html" />
<link rel="import" href="/lib/paper-toast-master/paper-toast.html" />

<link rel="import" href="/lib/vaadin-valo-theme/vaadin-date-picker.html">
<link rel="import" href="/lib/vaadin-valo-theme/vaadin-checkbox.html">
<link rel="import" href="/lib/vaadin-text-field/vaadin-text-field.html">
<link rel="import" href="/lib/vaadin-date-picker/vaadin-date-picker.html">
<link rel="import" href="/lib/vaadin-grid/vaadin-grid.html">
<link rel="import" href="/lib/vaadin-grid/vaadin-grid-filter.html">
<link rel="import" href="/lib/vaadin-grid/vaadin-grid-sorter.html">
<link rel="import" href="/lib/vaadin-checkbox/vaadin-checkbox.html">
<link rel="import" href="/lib/vaadin-combo-box/vaadin-combo-box.html" />
<link rel="import" href="/lib/such-textarea/such-textarea.html">
<link rel="import" href="/lib/paper-collapse-item/paper-collapse-group.html">
<link rel="import" href="/lib/paper-collapse-item/paper-collapse-item.html">

<link rel="import" href="/lib/vaadin-upload/vaadin-upload-file.html">
<link rel="import" href="/lib/vaadin-upload/vaadin-upload.html">

<link rel="import" href="/lib/such-selectbox/such-selectbox.html">

<x-produtodetalhe></x-produtodetalhe>

<dom-module id="x-produtodetalhe">
    <template>
        <!-- STYLES -->
        <link rel="stylesheet" href="/lib/bootstrap/dist/css/bootstrap.css" />
        <link rel="stylesheet" href="/lib/font-awesome-4.7.0/css/font-awesome.min.css" />
        <link rel="stylesheet" href="/css/main.css" />
        <style>
            vaadin-combo-box {
                margin-top: 0px !important;
                width: 100% !important;
            }

            vaadin-date-picker {
                margin-top: 0px !important;
                width: 100% !important;
            }

            vaadin-text-field {
                margin-top: 0px !important;
                width: 100%;
            }

            paper-button {
                margin-top: 10px;
            }

            .break_clear {
                margin-top: 15px;
                margin-right: 0px !important;
                margin-left: 0px !important;
            }

            .break_frm {
                margin-top: 15px;
            }

            .marginSpace {
                margin: 0px !important;
            }

            paper-collapse-item {
                --paper-item: { padding: 0 0;};
                --paper-collapse-item-header: {
                        padding: 0 15px;
                        color: #333;
                        background-color: #f5f5f5;
                        border-bottom: solid #ddd 1px;
                        border-top-left-radius: 3px;
                        border-top-right-radius: 3px;

                    } --paper-collapse-toogle-icon: {
                    //display: none;
                    } --paper-collapse-item-content {

                    }
            }
        </style>

        <iron-ajax url="/Produtos/GetProdutoNo"
                   last-response="{{result}}"
                   method="post"
                   handle-as="json"
                   id="page_databound_ajax"
                   content-type="application/json">
        </iron-ajax>

        <iron-ajax url="/Produtos/CreateProduto"
                   last-response="{{createProduto}}"
                   method="post"
                   handle-as="json"
                   id="page_createProduto_ajax"
                   on-response="_createProduto_Response"
                   content-type="application/json">
        </iron-ajax>

        <iron-ajax url="/Produtos/UpdateProduto"
                   last-response="{{updateProduto}}"
                   method="post"
                   handle-as="json"
                   id="page_updateProduto_ajax"
                   on-response="_updateProduto_Response"
                   content-type="application/json">
        </iron-ajax>

        <iron-ajax url="/Produtos/DeleteProduto"
                   last-response="{{deleteProduto}}"
                   method="post"
                   handle-as="json"
                   id="page_deleteProduto_ajax"
                   on-response="_deleteProduto_Response"
                   content-type="application/json">
        </iron-ajax>

        <iron-ajax url="/Produtos/CreateUnidadeMedidaProduto"
                   last-response="{{createUMP}}"
                   method="post"
                   handle-as="json"
                   id="page_createUMP_ajax"
                   on-response="_createUMP_Response"
                   content-type="application/json">
        </iron-ajax>

        <iron-ajax url="/Produtos/UpdateUnidadeMedidaProduto"
                   last-response="{{updateUMP}}"
                   method="post"
                   handle-as="json"
                   id="page_updateUMP_ajax"
                   on-response="_updateUMP_Response"
                   content-type="application/json">
        </iron-ajax>

        <iron-ajax url="/Produtos/DeleteUnidadeMedidaProduto"
                   last-response="{{deleteUMP}}"
                   method="post"
                   handle-as="json"
                   id="page_deleteUMP_ajax"
                   on-response="_deleteUMP_Response"
                   content-type="application/json">
        </iron-ajax>

        <iron-ajax url="/Produtos/ShowImage"
                   last-response="{{image}}"
                   method="post"
                   handle-as="json"
                   id="page_showImage_ajax"
                   on-response="_showImage_Response"
                   content-type="application/json">
        </iron-ajax>

        <iron-ajax url="/PopulateDropdowns/GetAllProductsPortal"
                   id="filteredProducts_ajax"
                   auto
                   last-response="{{Products}}"
                   method="post"
                   handle-as="json"
                   content-type="application/json">
        </iron-ajax>

        <iron-ajax url="/PopulateDropdowns/GetProdutosUnidadesMedidas"
                   last-response="{{ProdutoUnidadesMedidas}}"
                   auto
                   method="post"
                   handle-as="json"
                   content-type="application/json">
        </iron-ajax>

        <iron-ajax url="/PopulateDropdowns/GetProdutosTipos"
                   last-response="{{ProdutoTipos}}"
                   auto
                   method="post"
                   handle-as="json"
                   content-type="application/json">
        </iron-ajax>

        <iron-ajax url="/PopulateDropdowns/GetProdutosTiposRefeicao"
                   last-response="{{ProdutoTiposRefeicao}}"
                   auto
                   method="post"
                   handle-as="json"
                   content-type="application/json">
        </iron-ajax>

        <iron-ajax last-response="{{checkSession}}"
                   method="post"
                   handle-as="json"
                   id="ajax_check"
                   on-response="_sessionResponse"
                   content-type="application/json">
        </iron-ajax>

        <div class="subMenu">
            <paper-button class="tablinks" on-tap="_goBack" title="Voltar"><i class="fa fa-arrow-left" aria-hidden="true"></i> Voltar</paper-button>

            <paper-button id="btnCriar" class="btnEdit tablinks" value="createBtt" on-tap="_createProduto" disabled="{{ !_permissions.create }}"><i class="fa fa-floppy-o" aria-hidden="true"></i>&nbsp; Criar</paper-button>
            <paper-button id="btnGuardar" class="btnEdit tablinks" value="updateBtt" on-tap="_updateProduto" disabled="{{ !_permissions.update }}"><i class="fa fa-floppy-o" aria-hidden="true"></i>&nbsp; Guardar</paper-button>
            <paper-button id="btnEliminar" class="btnRemove tablinks" value="deleteBtt" on-tap="_deleteProduto" disabled="{{ !_permissions.delete }}"><i class="fa fa-trash-o" aria-hidden="true"></i>&nbsp; Eliminar</paper-button>
            <paper-button id="btnMovimento" class="btnSave tablinks" value="goMovement" on-tap="_goProductMovement"><i class="fa fa-arrow-right" aria-hidden="true"></i>&nbsp; Movimentos</paper-button>
        </div>

        <div class="row break_frm">
            <div class="col-md-12 col-md-12 col-lg-12">
                <iron-form id="formContract">

                    <div class="panel panel-default">
                        <div class="panel-body">
                            <paper-tabs fit-container no-slide autoselect autoselect-delay="0" selected="{{selected}}">
                                <paper-tab>Geral</paper-tab>
                                <paper-tab>Valores Energéticos</paper-tab>
                                <paper-tab>Valores Alergénios</paper-tab>
                            </paper-tabs>

                            <iron-pages selected="{{selected}}">
                                <!--Geral-->
                                <div>
                                    <div class="col-md-12">
                                        <div class="col-md-10">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    @*<vaadin-text-field id="ddno" name="ddno" label="Nº" value="{{result.no}}" disabled></vaadin-text-field>*@

                                                    <such-selectbox id="ddno" label="Nº"
                                                                    value="{{result.code}}"
                                                                    items="[[Products]]"
                                                                    text-path="code"
                                                                    value-path="code"
                                                                    fields='[{"field":"code", "name":"Cód. Produto"}, {"field":"name", "name":"Descrição"}, {"field":"measureUnit", "name":"Unidade de Medida"}, {"field":"itemCategoryCode", "name":"Cód. Categoria"}, {"field":"productGroupCode", "name":"Cód. Grupo"}]'
                                                                    disabled="{{ !_permissions.update }}"
                                                                    on-value-changed="_onProductChanged">
                                                    </such-selectbox>
                                                </div>

                                                <div class="col-md-4">
                                                    <vaadin-text-field id="dddescricao" name="dddescricao" label="Descrição" value="{{result.descricao}}" disabled></vaadin-text-field>
                                                </div>

                                                <div class="col-md-4">
                                                    <vaadin-text-field id="dddescricao2" name="dddescricao2" label="Descrição 2" value="{{result.descricao2}}" disabled></vaadin-text-field>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-4">
                                                    <vaadin-combo-box items="[[ProdutoUnidadesMedidas]]" id="ddunidadeMedidaBase" name="ddunidadeMedidaBase" label="Unidade Medida Base" item-value-path="id" item-label-path="value" value="{{result.unidadeMedidaBase}}" disabled>
                                                        <template>
                                                            <table width="250px">
                                                                <tr>
                                                                    <td width="100%"><b>[[item.value]]</b></td>
                                                                </tr>
                                                            </table>
                                                        </template>
                                                    </vaadin-combo-box>
                                                </div>

                                                <div class="col-md-4">
                                                    <vaadin-text-field id="ddprecoUnitario" name="ddprecoUnitario" label="Preço Unitário" value="{{result.precoUnitario}}" type="number" maxlength="38" pattern="[0-9]+([\.][0-9]+)?" on-value-changed="_ConvertDecimals"></vaadin-text-field>
                                                </div>

                                                <div class="col-md-4">
                                                    <vaadin-text-field id="ddcustoUnitario" name="ddcustoUnitario" label="Custo Unitário" value="{{result.custoUnitario}}" type="number" maxlength="38" pattern="[0-9]+([\.][0-9]+)?" on-value-changed="_ConvertDecimals"></vaadin-text-field>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-4">
                                                    <vaadin-text-field id="ddinventario" name="ddinventario" label="Inventário" value="{{result.inventario}}" disabled></vaadin-text-field>
                                                </div>

                                                <div class="col-md-4">
                                                    <vaadin-combo-box items="[[ProdutoTipos]]" id="ddtipo" name="ddtipo" label="Tipo" item-value-path="id" item-label-path="value" value="{{result.tipo}}">
                                                        <template>
                                                            <table width="250px">
                                                                <tr>
                                                                    <td width="100%"><b>[[item.value]]</b></td>
                                                                </tr>
                                                            </table>
                                                        </template>
                                                    </vaadin-combo-box>
                                                </div>

                                                <div class="col-md-4">
                                                    <vaadin-combo-box items="[[ProdutoTiposRefeicao]]" id="ddtipoRefeicao" name="ddtipoRefeicao" label="Tipo Refeição" item-value-path="id" item-label-path="id" value="{{result.tipoRefeicao}}" on-value-changed="_getTipoRefeicaoDescricao">
                                                        <template>
                                                            <table width="250px">
                                                                <tr>
                                                                    <td width="100%"><b>[[item.id]]</b> - [[item.value]]</td>
                                                                </tr>
                                                            </table>
                                                        </template>
                                                    </vaadin-combo-box>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-4">
                                                    <vaadin-text-field id="dddescricaoRefeicao" name="dddescricaoRefeicao" label="Descrição Tipo Refeição" value="{{result.descricaoRefeicao}}" disabled></vaadin-text-field>
                                                </div>

                                                <div class="col-md-4">
                                                    <vaadin-text-field id="ddnoPrateleira" name="ddnoPrateleira" label="Nº Prateleira" value="{{result.noPrateleira}}"></vaadin-text-field>
                                                </div>

                                                <div class="col-md-4">
                                                    <vaadin-text-field id="ddnomeCurtoSISLOG" name="ddnomeCurtoSISLOG" label="Nome Curto SISLOG" value="{{result.nomeCurtoSISLOG}}" maxlength="15"></vaadin-text-field>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-7">
                                                    <vaadin-upload id="UploadRequest"
                                                                   method="POST"
                                                                   headers="{'Accept': 'application/json'}"
                                                                   accept=".jpg"
                                                                   timeout=3000000
                                                                   max-files="1">
                                                        <span slot="drop-label">Coloque aqui a sua imagem...</span>
                                                    </vaadin-upload>
                                                </div>

                                                <div class="col-sm-1" style="padding-top:-200px">
                                                    <paper-button class="btnSave" disabled="{{ !_permissions.create }}" raised on-tap="_uploadImagem">Transferir</paper-button>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-2" style="align-items:center">
                                            <figure style="align-self:center">
                                                <img src="@Url.Action("ShowImage", "Produtos", new { ProdutoNo = this.ViewBag.No })" alt="" width="225" height="300" />
                                            </figure>
                                        </div>
                                    </div>




                                    <!------------ UNIDADE MEDIDA PRODUTO ------------>


                                    <paper-collapse-group>
                                        <paper-collapse-item class="panel-heading" header="Unidade Medida Produto" closed>
                                            <div class="panel-body">
                                                <div class="row break_clear">
                                                    <div class="col-md-3 ">
                                                        <vaadin-combo-box items="[[ProdutoUnidadesMedidas]]" id="ddUMPcode" name="ddUMPcode" label="Unidade Medida Base" item-value-path="id" item-label-path="value">
                                                            <template>
                                                                <table width="250px">
                                                                    <tr>
                                                                        <td width="100%"><b>[[item.value]]</b></td>
                                                                    </tr>
                                                                </table>
                                                            </template>
                                                        </vaadin-combo-box>
                                                    </div>

                                                    <div class="col-md-3 ">
                                                        <vaadin-text-field id="ddUMPqtdUnitMeasure" name="ddUMPqtdUnitMeasure" label="Qtd. Por Unidade Medida" value="{{result.qtdUnitMeasure}}" type="number" maxlength="38" pattern="[0-9]+([\.][0-9]+)?" on-value-changed="_ConvertDecimals"></vaadin-text-field>
                                                    </div>

                                                    <div class="col-sm-1" style="padding-top:32px">
                                                        <center>
                                                            <paper-button id="btn_createUnidadeMedidaProduto" class="btnSave tableBtn" raised on-tap="_createUMP" disabled="{{ !_permissions.create }}" title="Adicionar"><i class="fa fa-plus" aria-hidden="true"></i></paper-button>
                                                        </center>
                                                    </div>
                                                </div>
                                            </div>
                                        </paper-collapse-item>
                                    </paper-collapse-group>

                                    <vaadin-grid id="tabUnidadeMedidaProduto" aria-label="tabUnidadeMedidaProduto" items="{{ result.listUnidadeMedidaProduto }}" class="editGrid" multi-sort="true">
                                        <vaadin-grid-column resizable>
                                            <template class="header">
                                                <vaadin-grid-sorter path="code" style="text-align:center;">Unidade Medida</vaadin-grid-sorter>
                                                <vaadin-grid-filter path="code"></vaadin-grid-filter>
                                            </template>
                                            <template>
                                                <vaadin-combo-box items="[[ProdutoUnidadesMedidas]]" id="tabUnidadeMedidaProdutoCode" name="tabUnidadeMedidaProdutoCode" item-value-path="id" item-label-path="value" value="{{item.code}}" disabled>
                                                    <template>
                                                        <table width="250px">
                                                            <tr>
                                                                <td width="100%"><b>[[item.value]]</b></td>
                                                            </tr>
                                                        </table>
                                                    </template>
                                                </vaadin-combo-box>

                                            </template>
                                        </vaadin-grid-column>

                                        <vaadin-grid-column resizable>
                                            <template class="header">
                                                <vaadin-grid-sorter path="qtdUnitMeasure" style="text-align:center;">Qtd. Por Unidade Medida</vaadin-grid-sorter>
                                                <vaadin-grid-filter path="qtdUnitMeasure"></vaadin-grid-filter>
                                            </template>
                                            <template>
                                                <vaadin-text-field id="tabUnidadeMedidaProdutoqtdUnitMeasure" value="{{item.qtdUnitMeasure}}" type="number" maxlength="38" pattern="[0-9]+([\.][0-9]+)?" on-value-changed="_ConvertDecimals"></vaadin-text-field>
                                            </template>
                                        </vaadin-grid-column>

                                        <vaadin-grid-column resizable>
                                            <template class="header">
                                            </template>
                                            <template>
                                                <center>
                                                    <paper-button id="btn_updateUnidadeMedidaProduto" class="btnSave tableBtn" raised on-tap="_updateUMP" disabled="{{ !_permissions.update }}" title="Gravar"><i class="fa fa-save" aria-hidden="true"></i></paper-button>
                                                    <paper-button id="btn_deleteUnidadeMedidaProduto" class="btnRemove tableBtn" raised on-tap="_deleteUMP" disabled="{{ !_permissions.delete }}" title="Eliminar"><i class="fa fa-trash" aria-hidden="true"></i></paper-button>
                                                </center>
                                            </template>
                                        </vaadin-grid-column>
                                    </vaadin-grid>
                                </div>



                                <!--Valores Energéticos-->
                                <div>
                                    <div class="row break_clear">
                                        <div class="col-md-3 ">
                                            <vaadin-text-field id="dddescricao" name="dddescricao" label="Descrição" value="{{result.descricao}}" disabled></vaadin-text-field>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-text-field id="ddproteinas" name="ddproteinas" label="Proteínas" value="{{result.proteinas}}" type="number" maxlength="38" pattern="[0-9]+([\.][0-9]+)?" on-value-changed="_ConvertDecimals"></vaadin-text-field>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-text-field id="ddglicidos" name="ddglicidos" label="Glícidos" value="{{result.glicidos}}" type="number" maxlength="38" pattern="[0-9]+([\.][0-9]+)?" on-value-changed="_ConvertDecimals"></vaadin-text-field>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-text-field id="ddlipidos" name="ddlipidos" label="Lípidos" value="{{result.lipidos}}" type="number" maxlength="38" pattern="[0-9]+([\.][0-9]+)?" on-value-changed="_ConvertDecimals"></vaadin-text-field>
                                        </div>
                                    </div>

                                    <div class="row break_clear">
                                        <div class="col-md-3 ">
                                            <vaadin-text-field id="ddfibraAlimentar" name="ddfibraAlimentar" label="Fibra Alimentar" value="{{result.fibraAlimentar}}" type="number" maxlength="38" pattern="[0-9]+([\.][0-9]+)?" on-value-changed="_ConvertDecimals"></vaadin-text-field>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-text-field id="ddvalorEnergetico" name="ddvalorEnergetico" label="Valor Energético" value="{{result.valorEnergetico}}" disabled type="number" maxlength="38" pattern="[0-9]+([\.][0-9]+)?" on-value-changed="_ConvertDecimals"></vaadin-text-field>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-text-field id="ddvitaminaA" name="ddvitaminaA" label="Vitamina A" value="{{result.vitaminaA}}" type="number" maxlength="38" pattern="[0-9]+([\.][0-9]+)?" on-value-changed="_ConvertDecimals"></vaadin-text-field>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-text-field id="ddvitaminaD" name="ddvitaminaD" label="Vitamina D" value="{{result.vitaminaD}}" type="number" maxlength="38" pattern="[0-9]+([\.][0-9]+)?" on-value-changed="_ConvertDecimals"></vaadin-text-field>
                                        </div>
                                    </div>

                                    <div class="row break_clear">
                                        <div class="col-md-3 ">
                                            <vaadin-text-field id="ddcolesterol" name="ddcolesterol" label="Colesterol" value="{{result.colesterol}}" type="number" maxlength="38" pattern="[0-9]+([\.][0-9]+)?" on-value-changed="_ConvertDecimals"></vaadin-text-field>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-text-field id="ddsodio" name="ddsodio" label="Sódio (NA)" value="{{result.sodio}}" type="number" maxlength="38" pattern="[0-9]+([\.][0-9]+)?" on-value-changed="_ConvertDecimals"></vaadin-text-field>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-text-field id="ddacidosGordosSaturados" name="ddacidosGordosSaturados" label="Ácidos Gordos Saturados" value="{{result.acidosGordosSaturados}}" type="number" maxlength="38" pattern="[0-9]+([\.][0-9]+)?" on-value-changed="_ConvertDecimals"></vaadin-text-field>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-text-field id="ddacucares" name="ddacucares" label="Açucares" value="{{result.acucares}}" type="number" maxlength="38" pattern="[0-9]+([\.][0-9]+)?" on-value-changed="_ConvertDecimals"></vaadin-text-field>
                                        </div>
                                    </div>

                                    <div class="row break_clear">
                                        <div class="col-md-3 ">
                                            <vaadin-text-field id="ddsal" name="ddsal" label="Sal" value="{{result.sal}}" type="number" maxlength="38" pattern="[0-9]+([\.][0-9]+)?" on-value-changed="_ConvertDecimals"></vaadin-text-field>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-text-field id="ddpotacio" name="ddpotacio" label="Potácio (k)" value="{{result.potacio}}" type="number" maxlength="38" pattern="[0-9]+([\.][0-9]+)?" on-value-changed="_ConvertDecimals"></vaadin-text-field>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-text-field id="ddcalcio" name="ddcalcio" label="Cálcio (Ca)" value="{{result.calcio}}" type="number" maxlength="38" pattern="[0-9]+([\.][0-9]+)?" on-value-changed="_ConvertDecimals"></vaadin-text-field>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-text-field id="ddferro" name="ddferro" label="Ferro" value="{{result.ferro}}" type="number" maxlength="38" pattern="[0-9]+([\.][0-9]+)?" on-value-changed="_ConvertDecimals"></vaadin-text-field>
                                        </div>
                                    </div>

                                    <div class="row break_clear">
                                        <div class="col-md-3 ">
                                            <vaadin-text-field id="ddedivel" name="ddedivel" label="Edível" value="{{result.edivel}}" type="number" maxlength="38" pattern="[0-9]+([\.][0-9]+)?" on-value-changed="_ConvertDecimals"></vaadin-text-field>
                                        </div>
                                    </div>
                                </div>



                                <!--Valores Alergénios-->
                                <div>
                                    <div class="row break_clear">
                                        <div class="col-md-3 ">
                                            <vaadin-checkbox id="ddcereais" name="ddcereais" checked="{{result.cereais}}">Cereais Que Contêm Glúten</vaadin-checkbox>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-checkbox id="ddcrustaceos" name="ddcrustaceos" checked="{{result.crustaceos}}">Crustáceos e Produtos à Base de Crustáceos</vaadin-checkbox>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-checkbox id="ddovos" name="ddovos" checked="{{result.ovos}}">Ovos e Produtos à Base de Ovos</vaadin-checkbox>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-checkbox id="ddpeixes" name="ddpeixes" checked="{{result.peixes}}">Peixes e Produtos à Base de Peixes</vaadin-checkbox>
                                        </div>
                                    </div>

                                    <div class="row break_clear">
                                        <div class="col-md-3 ">
                                            <vaadin-checkbox id="ddamendoins" name="ddamendoins" checked="{{result.amendoins}}">Amendoins e Produtos à Base de Amendoins</vaadin-checkbox>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-checkbox id="ddsoja" name="ddsoja" checked="{{result.soja}}">Soja e Produtos à Base de Soja</vaadin-checkbox>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-checkbox id="ddleite" name="ddleite" checked="{{result.leite}}">Leite e Produtos à Base de Leite</vaadin-checkbox>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-checkbox id="ddfrutasDeCascaRija" name="ddfrutasDeCascaRija" checked="{{result.frutasDeCascaRija}}">Frutas de Casca Rija e Produtos à Base de Frutas de Casca Rija</vaadin-checkbox>
                                        </div>
                                    </div>

                                    <div class="row break_clear">
                                        <div class="col-md-3 ">
                                            <vaadin-checkbox id="ddaipo" name="ddaipo" checked="{{result.aipo}}">Aipo e Produtos à Base de Aipo</vaadin-checkbox>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-checkbox id="ddmostarda" name="ddmostarda" checked="{{result.mostarda}}">Mostarda e Produtos à Base de Mostarda</vaadin-checkbox>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-checkbox id="ddsementesDeSesamo" name="ddsementesDeSesamo" checked="{{result.sementesDeSesamo}}">Sementes de Sésamo e Produtos à Base de Sementes de Sésamo</vaadin-checkbox>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-checkbox id="dddioxidoDeEnxofreESulfitos" name="dddioxidoDeEnxofreESulfitos" checked="{{result.dioxidoDeEnxofreESulfitos}}">Dióxido de Enxofre e Sulfitos em Concentração Superior a 10 mg/kg ou 10 mg/l</vaadin-checkbox>
                                        </div>
                                    </div>

                                    <div class="row break_clear">
                                        <div class="col-md-3 ">
                                            <vaadin-checkbox id="ddtremoco" name="ddtremoco" checked="{{result.tremoco}}">Tremoço e Produtos à Base de Tremoço</vaadin-checkbox>
                                        </div>

                                        <div class="col-md-3 ">
                                            <vaadin-checkbox id="ddmoluscos" name="ddmoluscos" checked="{{result.moluscos}}">Moluscos e Produtos à Base de Moluscos</vaadin-checkbox>
                                        </div>
                                    </div>
                                </div>
                            </iron-pages>
                        </div>
                    </div>
                </iron-form>
            </div>
        </div>

        <paper-toast id="ToastMessageSuccess" duration="4000" horizontalAlign="right" class="toastSuccess">&nbsp;<i class="fa fa-check fa-lg" aria-hidden="true"></i></paper-toast>
        <paper-toast id="ToastMessageError" duration="4000" horizontalAlign="right" class="toastError">&nbsp;<i class="fa fa-exclamation-triangle" aria-hidden="true"></i></paper-toast>
    </template>

    <script>
        window.addEventListener('WebComponentsReady', function () {
            var upload = document.querySelector('vaadin-upload#UploadRequest');

            upload.addEventListener('upload-response', function (event) {
                console.log('upload xhr after server response: ', event.detail.xhr);
                event.detail.file.error = 'Custom server error message.';
                this.openToastError(event.detail.file.name + ' erro: ' + event.detail.error);
            });

            upload.addEventListener('file-reject', function (event) {
                this.openToastError(event.detail.file.name + ' erro: ' + event.detail.error);
            });
        });

        document.addEventListener('WebComponentsReady', function () {
            Polymer({
                is: 'x-produtodetalhe',
                properties: {
                    selected: {
                        type: Number,
                        value: 0
                    },
                    _permissions: {
                        type: Array,
                        value: @Html.Raw(Json.Serialize(ViewBag.UPermissions)),
                    },
                    _produtoNo: {
                        type: String,
                        notify: true,
                        value: ""
                    },
                },

                ready: function () {
                    var _self = this;

                    this.$.page_databound_ajax.body = JSON.stringify('@ViewBag.No');
                    this.$.page_databound_ajax.generateRequest();

                    //Inserir
                    if (@ViewBag.ButtonHide == 1) {
                        $(this.$.btnCriar).removeClass('hidden');
                        $(this.$.btnGuardar).addClass('hidden');
                        $(this.$.btnEliminar).addClass('hidden');
                        $(this.$.btnMovimento).addClass('hidden');
                        _self.$.ddno.disabled = false;
                    } else {
                        $(this.$.btnCriar).addClass('hidden');
                        $(this.$.btnGuardar).removeClass('hidden');
                        $(this.$.btnEliminar).removeClass('hidden');
                        $(this.$.btnMovimento).removeClass('hidden');
                        _self.$.ddno.disabled = true;
                    }
                },

                openToast: function (message) {
                    this.$.ToastMessageSuccess.text = message;
                    this.$.ToastMessageSuccess.open();
                },

                openToastError: function (message) {
                    this.$.ToastMessageError.text = message;
                    this.$.ToastMessageError.open();
                },

                _ConvertDecimals: function (e) {
                    e.target.value = e.target.value.replace(",", ".");

                    if (e.target.name == "ddproteinas" | e.target.name == "ddglicidos" | e.target.name == "ddlipidos") {
                        var proteinas = parseFloat(0);
                        var glicidos = parseFloat(0);
                        var lipidos = parseFloat(0);

                        if (this.$.ddproteinas.value != undefined)
                            proteinas = parseFloat(this.$.ddproteinas.value);
                        if (this.$.ddglicidos.value != undefined)
                            glicidos = parseFloat(this.$.ddglicidos.value);
                        if (this.$.ddlipidos.value != undefined)
                            lipidos = parseFloat(this.$.ddlipidos.value);

                        this.$.ddvalorEnergetico.value = (proteinas * 4) + (glicidos * 4) + (lipidos * 9)
                    }
                },

                _onProductChanged: function (e) {
                    var item = this.Products.find(x => x.code == e.detail.value);
                    if (item != null) {
                        this.$.dddescricao.value = item.Name;
                        this.$.dddescricao2.value = item.Name2;
                        this.$.ddprecoUnitario.value = item.lastCostDirect;
                        this.$.ddcustoUnitario.value = item.unitCost;
                    }
                    else {
                        this.$.dddescricao.value = "";
                        this.$.dddescricao2.value = "";
                        this.$.ddprecoUnitario.value = "";
                        this.$.ddcustoUnitario.value = "";
                    }
                },

                _getTipoRefeicaoDescricao: function (e) {
                    if (e.target.value != "")
                        this.$.dddescricaoRefeicao.value = e.target.__data.selectedItem.value;
                    else
                        this.$.dddescricaoRefeicao.value = "";
                },

                _createUMP: function() {
                    if (this.$.ddno.value != null) {
                        if (this.$.ddUMPcode.value != "") {
                            if (this.$.ddUMPqtdUnitMeasure.validate()) {
                                this.$.page_createUMP_ajax.body = JSON.stringify({
                                    productNo: this.$.ddno.value,
                                    code: this.$.ddUMPcode.value,
                                    qtdUnitMeasure: this.$.ddUMPqtdUnitMeasure.value
                                });
                                this.$.page_createUMP_ajax.generateRequest();
                                this.$.tabUnidadeMedidaProduto.clearCache();
                            }
                            else {
                                this.openToastError('O valor do campo Qtd. Por Unidade Medida não é válido.');
                            }
                        }
                        else {
                            this.openToastError('O campo Unidade Medida Base não têm valor.');
                        }
                    }
                    else {
                        this.openToastError('Primeiro tem que criar o produto.');
                    }
                },

                _createUMP_Response: function (e) {
                    if (this.createUMP.eReasonCode == 0) {
                        this.openToast(this.createUMP.eMessage);
                        this.$.page_databound_ajax.generateRequest();
                    } else {
                        this.openToastError(this.createUMP.eMessage);
                    };
                },

                _updateUMP: function (e) {
                    var index = this.result.listUnidadeMedidaProduto.indexOf(e.model.item);

                    this.$.page_updateUMP_ajax.body = JSON.stringify({
                        productNo: e.model.item.productNo,
                        code: e.model.item.code,
                        qtdUnitMeasure: e.model.item.qtdUnitMeasure
                    });
                    this.$.page_updateUMP_ajax.generateRequest();
                    this.$.tabUnidadeMedidaProduto.clearCache();
                },

                _updateUMP_Response: function (e) {
                    if (this.updateUMP.eReasonCode == 0) {
                        this.openToast(this.updateUMP.eMessage);
                        this.$.page_databound_ajax.generateRequest();
                    } else {
                        this.openToastError(this.updateUMP.eMessage);
                    };
                },

                _deleteUMP: function (e) {
                    var index = this.result.listUnidadeMedidaProduto.indexOf(e.model.item);
                    var productNo = e.model.item.productNo;
                    var code = e.model.item.code;
                    var ajax_request = this.$.page_deleteUMP_ajax;
                    var tab = this.$.tabUnidadeMedidaProduto;

                    bootbox.confirm({
                        message: "Tem a certeza que pretende remover a Unidade de Medida do Produto?",
                        buttons: {
                            confirm: {
                                label: 'Sim',
                                className: 'btn-success'
                            },
                            cancel: {
                                label: 'Não',
                                className: 'btn-danger'
                            }
                        },
                        callback: function (deleteUMP) {
                            if (deleteUMP) {
                                ajax_request.body = JSON.stringify({
                                    productNo: productNo,
                                    code: code
                                });
                                ajax_request.generateRequest();
                                tab.clearCache();
                            }
                        }
                    });
                },

                _deleteUMP_Response: function (e) {
                    if (this.deleteUMP.eReasonCode == 0) {
                        this.openToast(this.deleteUMP.eMessage);
                        this.$.page_databound_ajax.generateRequest();
                    } else {
                        this.openToastError(this.deleteUMP.eMessage);
                    };
                },

                _createProduto: function (e) {
                    this.$.page_createProduto_ajax.body = JSON.stringify(this.result);
                    this.$.page_createProduto_ajax.generateRequest();
                },

                _createProduto_Response: function (e) {
                    if (this.createProduto.eReasonCode == 0) {
                        this.openToast(this.createProduto.eMessage);
                        window.location.href = "/Produtos/Detalhes/" + this.createProduto.aux;
                    } else {
                        this.openToastError(this.createProduto.eMessage);
                    };
                },

                _updateProduto: function (e) {
                    this.$.page_updateProduto_ajax.body = JSON.stringify(this.result);
                    this.$.page_updateProduto_ajax.generateRequest();
                },

                _updateProduto_Response: function (e) {
                    if (this.updateProduto.eReasonCode == 0) {
                        this.openToast(this.updateProduto.eMessage);
                        //this.$.page_databound_ajax.generateRequest();
                        location.reload();
                    } else {
                        this.openToastError(this.updateProduto.eMessage);
                    };
                },

                _deleteProduto: function (e) {
                    var productNo = this.$.ddno.value;
                    var ajax_request = this.$.page_deleteProduto_ajax;

                    bootbox.confirm({
                        message: "Tem a certeza que pretende remover o Produto?",
                        buttons: {
                            confirm: {
                                label: 'Sim',
                                className: 'btn-success'
                            },
                            cancel: {
                                label: 'Não',
                                className: 'btn-danger'
                            }
                        },
                        callback: function (deleteProduto) {
                            if (deleteProduto) {
                                ajax_request.body = JSON.stringify({
                                    no: productNo
                                });
                                ajax_request.generateRequest();
                            }
                        }
                    });
                },

                _deleteProduto_Response: function (e) {
                    if (this.deleteProduto.eReasonCode == 0) {
                        this.openToast(this.deleteProduto.eMessage);
                        window.location.href = "/Produtos/List";
                    } else {
                        this.openToastError(this.deleteProduto.eMessage);
                    };
                },

                _goProductMovement: function (e) {
                    this.$.ajax_check.url = "/Produtos/SetSessionMovimentoProduto";
                    this.$.ajax_check.body = JSON.stringify(this.result);
                    this.$.ajax_check.generateRequest();
                },

                _sessionResponse: function (e) {

                    if (this.checkSession == true)
                        window.location.href = "/Produtos/Movimentos";
                    else
                        this.openToastError('Necessita de Nº Produto');
                },

                _uploadImagem: function () {
                    var _self = this;
                    var urlFile = "/Produtos/Upload_Imagem/";
                    var toastSuccess = _self.$.ToastMessage;
                    var toastError = _self.$.ToastError;
                    var data = new FormData();
                    var uploadFile = _self.$.UploadRequest.files;
                    var ajaxImport = _self.$.page_updateProduto_ajax;
                    var ajaxGetALL = _self.$.page_databound_ajax;
                    var vaadinGrid = _self.$.tabUnidadeMedidaProduto;
                    for (var i = 0; i < uploadFile.length; i++) {
                        data.append(uploadFile[i].name, uploadFile[i]);
                    }
                    $.ajax({
                        type: "POST",
                        url: urlFile,
                        contentType: false,
                        processData: false,
                        data: data,
                        success: function (imagem) {
                            _self.result.imagem = imagem;
                            ajaxImport.body = JSON.stringify(_self.result);
                            ajaxImport.generateRequest();
                            toastSuccess.text = "Produto atualizado com sucesso.";
                            toastSuccess.open();
                            ajaxGetALL.generateRequest();
                            vaadinGrid.clearCache();
                        },
                        error: function () {
                            toastError.text = "Ocorreu um problema ao fazer o upload do(s) Ficheiro(s).";
                            toastError.open();
                        }
                    });
                },

                _goBack: function (e) {
                    window.history.back();
                },

            });
        });
    </script>
</dom-module>


